<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-tooltip/core-tooltip.html">
<link rel="import" href="../count-scroll/count-scroll.html">

<polymer-element name="mini-gauge" attributes="tooltip value max delay transition type path percent">
  <template>
    <link rel="stylesheet" href="mini-gauge.css">

    <core-tooltip label="{{tooltip}}" position="bottom">
      <div class="mini-graph">
        <svg width="70" height="70">
          <path id="path" d="m2.619049,35c0,-17.890028 14.490923,-32.38095 32.380951,-32.38095c17.890026,0 32.380951,14.490922 32.380951,32.38095c0,17.89003 -14.490925,32.380951 -32.380951,32.380951c-17.890028,0 -32.380951,-14.490921 -32.380951,-32.380951z"/>
        </svg>

        <count-scroll value="{{value}}" delay="{{delay}}"
          max="{{max}}" percent="{{percent}}">
        </count-scroll>

        <content select="h2"></content>
        <content class="label"></content>
      </div>
    </core-tooltip>

  </template>
  <script>

  Polymer({
    tooltip: null,
    value: null,
    delay: 0,
    max: 200,
    transition: null,
    type: 'circle',
    percent: false,

    observe: {
      'type': 'updatePath',
      'path': 'updatePath'
    },

    ready: function() {
      this.updatePath();
      this.draw();
    },

    updatePath: function() {

    },

    draw: function() {
      this.length = this.$.path.getTotalLength();
      this.$.path.style.strokeDashoffset = this.length;
      this.$.path.style.strokeDasharray = this.length + ' ' + this.length;

      if (this.transition) {
        this.$.path.style.transition = this.$.path.style.WebkitTransition = this.transition;
      }

      setTimeout(function() {
        this.setValue();
      }.bind(this), this.delay);
    },

    setValue: function() {
      this.$.path.style.strokeDashoffset = (this.length - (this.length * (this.value/this.max)));
    }
  });

  </script>

</polymer-element>
